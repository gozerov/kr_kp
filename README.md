# Облачное решение для дистанционного управления промышленными устройствами

## Описание проекта

Данный проект представляет собой облачное решение для управления промышленными устройствами. Система предоставляет REST API для работы с устройствами и веб-интерфейс для их удобного управления. Приложение поддерживает добавление, удаление и переключение состояния устройств.

Для повышения производительности и отказоустойчивости система реализована с использованием кластерной архитектуры. Кластер серверной части состоит из нескольких реплик, которые обрабатывают запросы, поступающие через балансировщик нагрузки Nginx. Такой подход позволяет эффективно распределять нагрузку и обеспечивает стабильную работу приложения даже при повышенных нагрузках.

## Структура проекта

```
KR_KP/
├── app/                   # Серверная часть (Backend)
│   ├── __init__.py        # Инициализация пакета
│   ├── main.py            # Точка входа в приложение
│   ├── models.py          # Модели базы данных
│   ├── schemas.py         # Схемы данных
│   ├── database.py        # Подключение к базе данных
│   └── routers/           # Маршруты API
│       └── devices.py     # Управление устройствами
├── frontend/              # Клиентская часть (Frontend)
│   ├── public/            # Статические файлы
│   ├── src/               # Исходники React
│   │   ├── App.js         # Главный компонент приложения
│   ├── package.json       # Конфигурация фронтенда
│   └── Dockerfile         # Dockerfile для фронтенда
│
├── nginx.conf             # Конфигурация балансировщика Nginx
├── docker-compose.yml     # Конфигурация Docker Compose
├── requirements.txt       # Список зависимостей Python
├── Dockerfile             # Dockerfile для бэкенда
└── README.md              # Инструкция по запуску проекта
```

## Используемые технологии

- **FastAPI** — для создания REST API.
- **React** — для реализации веб-интерфейса.
- **PostgreSQL** — для хранения данных.
- **Docker Compose** — для развёртывания приложения.
- **Nginx** — для балансировки нагрузки между репликами серверной части.
- **Material-UI** — для стилизации клиентского интерфейса.

## Установка и запуск

1. Убедитесь, что у вас установлены **Docker** и **Docker Compose**.
2. Склонируйте репозиторий:
   ```bash
   git clone <repository_url>
   cd <project_folder>
   ```
3. Запустите приложение с помощью Docker Compose:
   ```bash
   docker-compose up --build
   ```
4. Приложение будет доступно по следующим адресам:
   - **Backend (Swagger)**: [http://localhost:8000/docs](http://localhost:8000/docs)
   - **Frontend**: [http://localhost:3000](http://localhost:3000)

## Основные функции

- Добавление устройств с указанием имени.
- Удаление устройств.
- Переключение состояния устройств (включено/выключено).
- Логирование операций.

## Кластеризация и балансировка нагрузки

Система построена с использованием кластерной архитектуры. Реплики серверной части управляются с помощью Docker Compose, а Nginx используется для балансировки нагрузки. Это позволяет равномерно распределять запросы между репликами и повышать надёжность системы.

### Преимущества кластеризации:
1. **Масштабируемость** — добавление новых реплик позволяет обрабатывать больше запросов.
2. **Отказоустойчивость** — система продолжает работать, даже если одна из реплик выходит из строя.
3. **Высокая производительность** — балансировщик нагрузки распределяет запросы, предотвращая перегрузку серверов.

Пример конфигурации Nginx для балансировки нагрузки:
```nginx
http {
    upstream backend_cluster {
        server backend:8000;
        server backend:8000;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://backend_cluster;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
```

## Примеры API-запросов

1. **Получение списка устройств**  
   GET `/devices/`  
   Пример ответа:
   ```json
   [
       {
           "id": 1,
           "name": "Device 1",
           "status": true
       },
       {
           "id": 2,
           "name": "Device 2",
           "status": false
       }
   ]
   ```

2. **Добавление устройства**  
   POST `/devices/`  
   Пример тела запроса:
   ```json
   {
       "name": "New Device",
       "status": false
   }
   ```

3. **Переключение состояния устройства**  
   PATCH `/devices/{id}/toggle`